#@ load("@ytt:data", "data")

#@ data.values.buildFlags.extend(["-sDISABLE_EXCEPTION_CATCHING=1"])

mainBuild:
  name: replicad_single.js
  bindings: #@ data.values.bindings
  emccFlags: #@ data.values.buildFlags

additionalCppCode: |

  class BRepToolsWrapper {
  public:
    static std::string Write(const TopoDS_Shape& shape) {
      std::ostringstream oss(std::ios::binary);
      BRepTools::Write(shape, oss);
      return oss.str();
    }

    static TopoDS_Shape Read(const std::string& data) {
      std::istringstream iss(data, std::ios::binary);
      TopoDS_Shape shape;
      BRep_Builder builder;
      Message_ProgressRange progress;
      BRepTools::Read(shape, iss, builder, progress);
      return shape;
    }
  };


  class GeomToolsWrapper {
  public:
    static std::string Write(const Handle(Geom2d_Curve)& geometry) {
      std::ostringstream oss(std::ios::binary);
      GeomTools::Write(geometry, oss);
      return oss.str();
    }

    static Handle(Geom2d_Curve) Read(const std::string& data) {
      std::istringstream iss(data, std::ios::binary);
      Handle(Geom2d_Curve) geometry;
      GeomTools::Read(geometry, iss);
      return geometry;
    }
  };
